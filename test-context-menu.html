<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Menu Test - AI Accessibility Enhancer</title>
    <script src="debug-logger.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-area {
            border: 2px dashed #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: #f8fafc;
        }
        
        .instructions {
            background: #e0f2fe;
            border: 1px solid #0288d1;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .debug-info {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 20px 0;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Context Menu Test SayfasÄ±</h1>
    
    <div class="instructions">
        <h3>ğŸ“‹ Test TalimatlarÄ±:</h3>
        <ol>
            <li><strong>Extension'Ä± yÃ¼kleyin</strong> (npm run build + Chrome extensions)</li>
            <li><strong>F12</strong> aÃ§Ä±n ve <strong>Console</strong> sekmesini izleyin</li>
            <li><strong>AÅŸaÄŸÄ±daki herhangi bir elemente saÄŸ tÄ±klayÄ±n</strong></li>
            <li><strong>"EriÅŸilebilirlik Analizi"</strong> seÃ§eneÄŸini tÄ±klayÄ±n</li>
            <li><strong>Modal'Ä±n aÃ§Ä±lÄ±p aÃ§Ä±lmadÄ±ÄŸÄ±nÄ± kontrol edin</strong></li>
        </ol>
    </div>

    <div class="test-area">
        <h2>ğŸ¯ Test AlanÄ± 1: Button</h2>
        <button id="test-button" onclick="alert('Test button clicked!')">
            Test Butonu - SaÄŸ TÄ±klayÄ±n!
        </button>
        <p>Bu butona saÄŸ tÄ±klayÄ±p context menu'yu test edin.</p>
    </div>

    <div class="test-area">
        <h2>ğŸ–¼ï¸ Test AlanÄ± 2: Image</h2>
        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='100'><rect width='200' height='100' fill='%2310b981'/><text x='100' y='55' text-anchor='middle' fill='white' font-family='Arial' font-size='16'>Test Image</text></svg>"
             alt="Test gÃ¶rseli - yeÅŸil arka plan Ã¼zerinde beyaz yazÄ±"
             style="border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <p>Bu gÃ¶rsele saÄŸ tÄ±klayÄ±p context menu'yu test edin.</p>
    </div>

    <div class="test-area">
        <h2>ğŸ“ Test AlanÄ± 3: Form</h2>
        <form>
            <label for="test-input">Test Input:</label>
            <input type="text" id="test-input" placeholder="Buraya yazÄ±n ve saÄŸ tÄ±klayÄ±n" style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
            
            <label for="test-textarea">Test Textarea:</label>
            <textarea id="test-textarea" placeholder="Bu textarea'ya saÄŸ tÄ±klayÄ±n" style="width: 100%; height: 80px; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;"></textarea>
        </form>
    </div>

    <div class="test-area">
        <h2>ğŸ“‹ Test AlanÄ± 4: Liste</h2>
        <ul id="test-list">
            <li>Liste Ã¶ÄŸesi 1 - saÄŸ tÄ±klayÄ±n</li>
            <li>Liste Ã¶ÄŸesi 2 - saÄŸ tÄ±klayÄ±n</li>
            <li>Liste Ã¶ÄŸesi 3 - saÄŸ tÄ±klayÄ±n</li>
        </ul>
    </div>

    <div class="debug-info" id="debug-log">
Konsol loglarÄ± buraya gelecek...

Expected Console Messages:
âœ… Background script loaded successfully
âœ… Context menu created: ai-accessibility-analyze
âœ… Content script loaded successfully
âœ… Context menu clicked: ai-accessibility-analyze
âœ… Content script received message: SHOW_WCAG_MODAL
âœ… WCAG Modal aÃ§Ä±lÄ±yor...
âœ… Modal DOM'a eklendi
    </div>

    <div class="test-area">
        <h2>ğŸ” Manuel Test ButonlarÄ±</h2>
        <button onclick="testExtensionStatus()">Extension Status Kontrol</button>
        <button onclick="testContentScript()">Content Script Test</button>
        <button onclick="testContextMenu()">Context Menu Test</button>
        <button onclick="clearDebugLog()">Debug Log Temizle</button>
        <button onclick="downloadDebugLogs()" style="background: #059669;">Debug LoglarÄ± Ä°ndir</button>
        <button onclick="forceShowModal()">Zorla Modal AÃ§</button>
    </div>

    <div id="test-results"></div>

    <script>
        // Debug logging
        const debugLog = document.getElementById('debug-log');
        const testResults = document.getElementById('test-results');

        function addDebugMessage(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            
            if (debugLog.textContent.includes('Konsol loglarÄ± buraya gelecek...')) {
                debugLog.textContent = logMessage;
            } else {
                debugLog.textContent += logMessage;
            }
            
            // Auto scroll
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        function showResult(message, success = true) {
            const resultDiv = document.createElement('div');
            resultDiv.className = success ? 'success' : 'error';
            resultDiv.innerHTML = `<strong>${success ? 'âœ…' : 'âŒ'}</strong> ${message}`;
            testResults.appendChild(resultDiv);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (resultDiv.parentNode) {
                    resultDiv.parentNode.removeChild(resultDiv);
                }
            }, 5000);
        }

        // Extension status test
        function testExtensionStatus() {
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                addDebugMessage('âœ… Chrome extension API available');
                showResult('Extension API eriÅŸilebilir', true);
            } else {
                addDebugMessage('âŒ Chrome extension API not available');
                showResult('Extension API eriÅŸilemiyor - Extension yÃ¼klÃ¼ mÃ¼?', false);
            }
        }

        // Content script test
        function testContentScript() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                // Test content script connection
                chrome.runtime.sendMessage({type: 'PING'}, (response) => {
                    if (chrome.runtime.lastError) {
                        addDebugMessage('âŒ Content script communication failed: ' + chrome.runtime.lastError.message);
                        showResult('Content script ile iletiÅŸim baÅŸarÄ±sÄ±z', false);
                    } else {
                        addDebugMessage('âœ… Content script responding: ' + JSON.stringify(response));
                        showResult('Content script Ã§alÄ±ÅŸÄ±yor', true);
                    }
                });
            } else {
                showResult('Chrome API eriÅŸilemiyor', false);
            }
        }

        function clearDebugLog() {
            debugLog.textContent = 'Debug log temizlendi...\n';
        }

        // Context menu test fonksiyonu
        function testContextMenu() {
            addDebugMessage('ğŸ§ª Context menu test baÅŸlatÄ±lÄ±yor...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                // Background script'e context menu test mesajÄ± gÃ¶nder
                chrome.runtime.sendMessage({
                    type: 'TEST_CONTEXT_MENU'
                }, (response) => {
                    if (chrome.runtime.lastError) {
                        addDebugMessage('âŒ Context menu test baÅŸarÄ±sÄ±z: ' + chrome.runtime.lastError.message);
                        showResult('Context menu test baÅŸarÄ±sÄ±z', false);
                    } else {
                        addDebugMessage('âœ… Context menu test yanÄ±tÄ±: ' + JSON.stringify(response));
                        showResult('Context menu sistemi Ã§alÄ±ÅŸÄ±yor', true);
                        
                        // Manuel modal aÃ§ma testi
                        setTimeout(() => {
                            addDebugMessage('ğŸ”§ Manuel modal aÃ§ma testi...');
                            chrome.runtime.sendMessage({
                                type: 'SHOW_WCAG_MODAL',
                                forceProvider: 'gemini'
                            }, (modalResponse) => {
                                if (chrome.runtime.lastError) {
                                    addDebugMessage('âŒ Manuel modal aÃ§ma baÅŸarÄ±sÄ±z: ' + chrome.runtime.lastError.message);
                                    showResult('Manuel modal aÃ§ma baÅŸarÄ±sÄ±z', false);
                                } else {
                                    addDebugMessage('âœ… Manuel modal aÃ§ma baÅŸarÄ±lÄ±: ' + JSON.stringify(modalResponse));
                                    showResult('Manuel modal aÃ§ma baÅŸarÄ±lÄ±', true);
                                }
                            });
                        }, 1000);
                    }
                });
            } else {
                addDebugMessage('âŒ Chrome extension API eriÅŸilemiyor');
                showResult('Chrome extension API eriÅŸilemiyor', false);
            }
        }

        // Zorla modal aÃ§ma fonksiyonu
        function forceShowModal() {
            addDebugMessage('ğŸš€ ZORLA MODAL AÃ‡MA TEST BAÅLATILIYOR...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                // Ä°lk olarak content script'in hazÄ±r olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                chrome.runtime.sendMessage({type: 'PING'}, (response) => {
                    if (chrome.runtime.lastError) {
                        addDebugMessage('âŒ Content script yanÄ±t vermiyor: ' + chrome.runtime.lastError.message);
                        showResult('Content script ile baÄŸlantÄ± baÅŸarÄ±sÄ±z', false);
                    } else {
                        addDebugMessage('âœ… Content script hazÄ±r, direkt modal aÃ§Ä±lÄ±yor...');
                        
                        // Background script Ã¼zerinden modal aÃ§
                        chrome.runtime.sendMessage({
                            type: 'SHOW_WCAG_MODAL',
                            forceProvider: 'gemini'
                        }, (response) => {
                            if (chrome.runtime.lastError) {
                                addDebugMessage('âŒ Background Ã¼zerinden modal aÃ§ma baÅŸarÄ±sÄ±z: ' + chrome.runtime.lastError.message);
                                showResult('Modal aÃ§ma baÅŸarÄ±sÄ±z', false);
                            } else {
                                addDebugMessage('âœ… Background Ã¼zerinden modal aÃ§ma yanÄ±tÄ±: ' + JSON.stringify(response));
                                showResult('Modal aÃ§ma isteÄŸi gÃ¶nderildi', true);
                            }
                        });
                    }
                });
            } else {
                addDebugMessage('âŒ Chrome extension API eriÅŸilemiyor');
                showResult('Chrome extension API eriÅŸilemiyor', false);
            }
        }

        // Console hijacking for debug
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;

        console.log = function(...args) {
            addDebugMessage('LOG: ' + args.join(' '));
            originalConsoleLog.apply(console, args);
        };

        console.error = function(...args) {
            addDebugMessage('ERROR: ' + args.join(' '));
            originalConsoleError.apply(console, args);
        };

        console.warn = function(...args) {
            addDebugMessage('WARN: ' + args.join(' '));
            originalConsoleWarn.apply(console, args);
        };

        // Page load
        document.addEventListener('DOMContentLoaded', function() {
            addDebugMessage('ğŸ¯ Test sayfasÄ± yÃ¼klendi');
            addDebugMessage('ğŸ’¡ Herhangi bir elemente saÄŸ tÄ±klayÄ±p context menu\'yu test edin');
            addDebugMessage('ğŸ”§ Extension dist klasÃ¶rÃ¼nden yÃ¼klenmelidir: chrome-axe-gemini/dist/');
            
            // Extension availability check
            setTimeout(testExtensionStatus, 500);
        });
// Right-click tracking
document.addEventListener('contextmenu', function(e) {
    const target = e.target;
    const elementInfo = `${target.tagName}${target.id ? '#' + target.id : ''}${target.className ? '.' + target.className.split(' ')[0] : ''}`;
    addDebugMessage(`ğŸ–±ï¸ SaÄŸ tÄ±k algÄ±landÄ±: ${elementInfo}`);
    
    // Element'i global olarak kaydet (content script iÃ§in)
    window.lastRightClickedElement = target;
    
    // Context menu aÃ§Ä±ldÄ±ktan sonra kontrol et
    setTimeout(() => {
        addDebugMessage('ğŸ” Context menu aÃ§Ä±ldÄ± - "EriÅŸilebilirlik Analizi" seÃ§eneÄŸini arayÄ±n');
        
        // Chrome API'sinin context menu'yu oluÅŸturup oluÅŸturmadÄ±ÄŸÄ±nÄ± kontrol et
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            addDebugMessage('âœ… Chrome API eriÅŸilebilir - Context menu Ã¶ÄŸeleri kontrol ediliyor');
            
            // Context menu debug mesajÄ± gÃ¶nder
            chrome.runtime.sendMessage({
                type: 'CONTEXT_MENU_DEBUG',
                elementInfo: elementInfo,
                timestamp: Date.now()
            }, (response) => {
                if (chrome.runtime.lastError) {
                    addDebugMessage('âš ï¸ Context menu debug mesajÄ± gÃ¶nderim hatasÄ±: ' + chrome.runtime.lastError.message);
                } else {
                    addDebugMessage('ğŸ“‹ Context menu debug yanÄ±tÄ±: ' + JSON.stringify(response));
                }
            });
        } else {
            addDebugMessage('âŒ Chrome API eriÅŸilemiyor - Extension yÃ¼klÃ¼ deÄŸil');
        }
    }, 100);
});
    </script>
</body>
</html>